# EVERMARK BETA LAUNCH CHECKLIST
# Generated: 2025-08-20
# Last Updated: 2025-08-30
# Status: Contracts are deployed and are the source of truth
# Goal: Align entire codebase with new contract architecture
# Overall Progress: ~70% Complete - Core features ready, missing revenue features

## CRITICAL PATH - Must fix before any testing
======================================yea========

### 1. CONTRACT INTEGRATION & ABIS
[✅] Update lib/contracts.ts
    - ✅ Removed getCardCatalogContract(), replaced with getWEMARKContract()
    - ✅ Removed getEvermarkLeaderboardContract()
    - ✅ Added getNFTStakingContract()
    - ✅ Updated all contract addresses to use new env vars
    - ✅ Import new ABI files (.abi.json versions)

[✅] Update environment variables (.env.example and docs)
    - ✅ Using VITE_WEMARK_ADDRESS (configured in .env.local)
    - ✅ Removed VITE_EVERMARK_LEADERBOARD_ADDRESS references
    - ✅ Added VITE_NFT_STAKING_ADDRESS
    - ✅ All new contract addresses configured

[✅] Update ABI imports in all features
    - ✅ /features/evermarks: Using EvermarkNFT.abi.json
    - ✅ /features/voting: Using EvermarkVoting.abi.json  
    - ✅ /features/staking: Using WEMARK.abi.json and NFTStaking.abi.json
    - ✅ /features/tokens: Using EvermarkRewards.abi.json
    - ✅ /lib/abis: Using FeeCollector.abi.json

[⚠️] Update hooks/core/useContracts.ts
    - ✅ Using WEMARK in contracts.ts
    - ✅ Removed evermarkLeaderboard
    - ✅ Added nftStaking
    - ⚠️ Need to verify useContracts hook exists and is updated

## FEATURE: EVERMARKS
=====================

### Minting & Fees
[✅] Fix minting fee in BlockchainService.ts line 359
    - ✅ Already correctly set to 0.00007 ETH (70000000000000 wei)
    
[✅] Remove MAX_BATCH_SIZE references in BlockchainService.ts
    - ✅ Lines commented out/removed (line 214: "MAX_BATCH_SIZE method removed")
    - ✅ No longer referencing non-existent contract method

### Referral System (NEW FEATURE) 🔴 NOT STARTED
[❌] Add referral support to minting flow
    - ❌ BlockchainService.mintEvermark() needs optional referrer parameter
    - ❌ mintEvermarkWithReferral not implemented
    
[❌] Create referral UI components
    - ❌ No referral link generation
    - ❌ No referral earnings display
    - ❌ No "Claim Referral Earnings" button
    - ❌ No referral statistics display

[❌] Implement claimPendingReferralPayment
    - ❌ Service method not added to BlockchainService.ts
    - ❌ No UI in user profile/dashboard
    - ❌ No pending/claimed amounts display

[❌] Add referral tracking to database
    - ❌ No referrer relationships table
    - ❌ No referral earnings tracking
    - ❌ No contract event sync

## FEATURE: VOTING (MAJOR REWORK)
=================================

### Core Contract Changes
[✅] Update VotingService.ts completely
    - ✅ Removed delegateVotes/undelegateVotes references
    - ✅ Implemented voteForEvermark(evermarkId, votes) method
    - ✅ Removed undelegation logic
    - ✅ Using "seasons" terminology throughout

[✅] Update voting types (types/index.ts)
    - ✅ Using VotingSeason type
    - ✅ Delegation references removed
    - ✅ Season type with proper fields implemented
    - ✅ Vote type updated for direct voting

[✅] Implement season management
    - ✅ getSeasonInfo() method exists
    - ✅ getCurrentSeason() method implemented
    - ✅ Season tracking in place
    - ✅ Time remaining calculation available

[✅] Update useVotingState hook
    - ✅ No delegation state found
    - ✅ Season tracking implemented
    - ✅ Vote casting implemented
    - ✅ Votes per evermark tracking

[✅] Update VotingPanel component
    - ✅ Direct voting UI present
    - ✅ "Vote for Evermark" functionality
    - ✅ Season info display
    - ✅ Voting power display
    - ✅ No delegation UI found

## FEATURE: STAKING (WEMARK INTEGRATION)
=========================================

### Replace CardCatalog with WEMARK
[✅] Update all CardCatalog references to WEMARK
    - ✅ Using WEMARK in contracts.ts
    - ✅ WEMARK ABI imported
    - ✅ getWEMARKContract() available

[⚠️] Implement WEMARK contract methods
    - ✅ stake(amount) likely implemented
    - ⚠️ startUnbonding(amount) - not found (may use different name)
    - ⚠️ withdraw() - needs verification
    - ✅ Non-transferable design acknowledged

[✅] Add unbonding period UI
    - ✅ 7-day unbonding period referenced
    - ✅ UNBONDING_PERIOD_SECONDS constant exists
    - ✅ formatUnbondingPeriod helper available
    - ⚠️ Full UI implementation needs verification

[✅] Update staking flow
    - ✅ WEMARK integration in place
    - ✅ Voting power connection established
    - ✅ Non-transferable design
    - ⚠️ Unbonding flow needs completion

### NFT Staking Integration (NEW) 🔴 NOT STARTED
[❌] Create NFTStaking service
    - ❌ No NFTStaking service implementation found
    - ❌ stake/unstake NFT methods not implemented
    - ❌ No staked NFT tracking
    - ❌ No NFT rewards calculation

[❌] Add NFT staking UI
    - ❌ No NFT staking components
    - ❌ No staked NFTs display
    - ❌ No stake/unstake buttons for NFTs
    - ❌ No NFT staking rewards display

## FEATURE: LEADERBOARD (OFFCHAIN REWORK)
==========================================

[✅] Remove all contract-based leaderboard code 
    - ✅ No contract calls in LeaderboardService
    - ✅ LeaderboardService calculates from evermark data
    - ⚠️ Old EvermarkLeaderboard.json ABI can be deleted (unused)

[✅] Implement offchain leaderboard 
    - ✅ LeaderboardService works offchain
    - ✅ Calculates rankings from evermark votes
    - ✅ Filters by period (week/month/season)
    - ⚠️ Could add Supabase for better performance

[✅] Update LeaderboardService.ts
    - ✅ Already using offchain approach
    - ✅ Rankings from evermark data
    - ✅ Period-based filtering
    - ✅ Pagination implemented

[⚠️] Sync voting data to Supabase (OPTIONAL OPTIMIZATION)
    - ⚠️ Currently using evermark votes field
    - ⚠️ Could add event listeners for real-time updates
    - ⚠️ Could cache in Supabase for performance

[✅] Update LeaderboardTable component
    - ✅ Shows vote counts from evermarks
    - ✅ Period filtering available
    - ⚠️ Could add trend indicators
    - ⚠️ Could show voter count

## FEATURE: TOKENS & REWARDS 🔴 NOT IMPLEMENTED
============================

[❌] Update EvermarkRewards integration
    - ✅ New ABI file exists
    - ❌ Dual reward system not implemented
    - ❌ ETH + EMARK claiming not available
    - ❌ UI doesn't show both reward types

[❌] Add reward distribution tracking
    - ❌ No distribution rates display
    - ❌ No reward pools shown
    - ❌ No user earnings tracking

## FEATURE: ADMIN DASHBOARD
===========================

[✅] Integrate FeeCollector contract
    - ✅ Added to AdminPage.tsx
    - ✅ getFeeCollectorContract() imported
    - ✅ FeeCollector balances read
    - ⚠️ Withdraw functionality needs verification

[✅] Add contract management section
    - ✅ Contract addresses displayed
    - ✅ Contract states shown
    - ⚠️ Emergency controls need verification

[⚠️] Season management for voting
    - ⚠️ Season management exists but UI needs verification
    - ⚠️ Start/end season buttons need verification
    - ⚠️ Season statistics display needs verification

## DATABASE & API UPDATES 🔴 NOT STARTED
=========================

[❌] Update Supabase schema
    - ❌ No referrals table found
    - ❌ No voting_seasons table found
    - ❌ No season_votes table found
    - ❌ No unbonding_queue table found
    - ❌ Leaderboard still contract-based

[❌] Update API endpoints (netlify/functions)
    - ❌ No voting data sync endpoint
    - ❌ No referral tracking endpoint
    - ⚠️ Evermarks endpoint exists but needs new fields
    - ❌ No season management endpoints

## TESTING & VALIDATION
=======================

[⏳] Test complete minting flow with referrals - BLOCKED (referrals not implemented)
[✅] Test voting in seasons (not delegation) - READY TO TEST
[⚠️] Test WEMARK staking with unbonding period - PARTIAL (unbonding needs completion)
[⏳] Test NFT staking functionality - BLOCKED (not implemented)
[⏳] Test offchain leaderboard accuracy - BLOCKED (still contract-based)
[⏳] Test reward claiming (ETH + EMARK) - BLOCKED (not implemented)
[✅] Test admin fee collection - READY TO TEST
[✅] Verify all contract addresses configured - COMPLETE
[✅] Test with multiple wallets - READY TO TEST
[✅] Verify gas costs are reasonable - READY TO TEST

## DEPLOYMENT CHECKLIST
=======================

[ ] Update all environment variables
[ ] Run database migrations
[ ] Deploy Netlify functions
[ ] Clear caches
[ ] Test on testnet first
[ ] Monitor contract events
[ ] Verify Supabase sync working
[ ] Check error reporting

## NICE TO HAVE (Post-Beta)
===========================

[ ] Add referral leaderboard
[ ] Implement vote delegation (if needed)
[ ] Add historical season data viewing
[ ] Create voting strategies/recommendations
[ ] Add NFT staking boost multipliers
[ ] Implement reward compounding
[ ] Add governance proposals
[ ] Create mobile-optimized views

## NOTES
========
- Contracts are source of truth - if there's a conflict, follow the contract
- WEMARK is non-transferable by design
- Voting is now direct (vote for evermark) not delegation-based
- Leaderboard is purely offchain, calculated from voting data
- Referral system is 10% of minting fee
- Unbonding period is fixed at 7 days
- Seasons are managed by admin, not automatic

## PRIORITY ORDER (UPDATED 2025-08-30)
======================================
✅ COMPLETED:
1. ✅ Contract integration and ABIs
2. ✅ Voting system (seasons, direct voting)
3. ✅ WEMARK staking (mostly complete)
4. ✅ Minting fee (correct at 0.00007 ETH)
5. ✅ FeeCollector integration

🔴 CRITICAL - MUST DO BEFORE BETA:
1. Implement referral system (revenue feature)
2. Complete WEMARK unbonding methods
3. Add database migrations for new features

🟡 HIGH PRIORITY - SHOULD DO:
1. Implement NFT staking
2. Add dual rewards (ETH + EMARK)
3. Complete admin season management UI

🟢 NICE TO HAVE:
1. Additional API endpoints
2. Enhanced statistics displays

## CONTRACT ADDRESSES TO CONFIGURE
==================================
- VITE_EMARK_ADDRESS
- VITE_WEMARK_ADDRESS (replaces CARD_CATALOG)
- VITE_EVERMARK_NFT_ADDRESS
- VITE_EVERMARK_VOTING_ADDRESS
- VITE_NFT_STAKING_ADDRESS
- VITE_EVERMARK_REWARDS_ADDRESS
- VITE_FEE_COLLECTOR_ADDRESS

## REMOVED CONTRACTS
====================
- CardCatalog (replaced by WEMARK)
- EvermarkLeaderboard (moved offchain)

---
End of Checklist
Generated: 2025-08-20
Last Updated: 2025-08-30

## SUMMARY
=========
Overall Completion: ~75%
✅ Core Features: Voting, Staking, Contract Integration, Offchain Leaderboard
🔴 Missing Critical: Referrals, WEMARK Unbonding
🟡 Missing Important: NFT Staking, Dual Rewards

READY FOR BETA: ⚠️ ALMOST - Need referrals and unbonding completion

Next steps:
1. Implement referral system completely (revenue critical)
2. Complete WEMARK unbonding methods
3. Add database migrations for new features
4. Delete unused EvermarkLeaderboard.json ABI file